cls

$mainPath = "D:\Translations\StarCruiserMD\"
$patchedRomPath = $mainPath + "ROM_Patched\Star Cruiser (WIP).md"
$file = [System.IO.File]::ReadAllBytes($patchedRomPath)

# Надо сделать меню по-нормальному, разобравшись в его наполнении и доделать Menu-Parse.ps1, но отвлекаться на это пока не хочется. Исправил ручками в роме и сдампил байты, которые и вставляются.

$bytes = @(0,27,0,20,0,52,0,46,0,64,0,57,0,80,0,73,0,98,0,90,30,32,73,84,69,77,0,4,5,11,12,14,15,16,27,28,36,37,39,40,41,42,43,44,45,255,32,73,78,70,79,0,32,33,34,35,255,32,65,82,77,83,0,0,0,1,2,3,7,8,9,10,255,32,80,65,82,84,83,0,6,22,23,24,25,26,29,30,31,255,30,32,69,78,71,78,69,0) | % {[byte]$_}

$importStartOffset = 47042 # 0000B7C2

0..($bytes.count-1) | %{
	$file[$_+$importStartOffset] = $bytes[$_]
}

# Тоже самое с названиями галактик - там есть закономерность, первые 8 байт - это смещения. Пока лень возиться сделать по-нормальному. Сдампил поменянное ручками в роме.

$bytes = @(0,8,0,19,0,34,0,47,10,83,111,108,97,114,30,30,30,11,0,10,30,64,32,67,101,110,116,97,117,114,105,30,11,0,10,30,83,105,114,105,117,115,30,30,30,11,0,10,30,66,97,114,110,97,114,100,30,30,30,30,30,11,0)

$importStartOffset = 6490 # 0000195A

0..($bytes.count-1) | %{
	$file[$_+$importStartOffset] = $bytes[$_]
}

# Тоже самое с текстом на заставке Great Battleship VOID.

#$bytes = @(9,6,22,84,104,101,32,71,114,101,97,116,32,66,97,116,116,108,101,115,104,105,112,32,115,112,101,99,115,0,1,244,9,6,21,76,101,110,103,116,104,58,32,52,46,53,32,107,109,46,9,6,23,87,101,105,103,104,116,58,32,85,110,107,110,111,119,110,9,6,25,85,110,105,116,115,32,58,32,52,48,48,48,48,32,32,32,0,1,244,9,6,22,73,116,32,104,97,118,101,32,97,32,98,105,103,32,119,97,114,112,32,101,110,103,105,110,101,9,6,24,102,111,114,32,97,32,98,105,103,32,106,117,109,112,115,46,0,2,138,9,6,21,34,86,45,82,69,70,76,69,67,84,34,32,115,121,115,116,101,109,32,114,101,112,101,108,115,32,97,110,121,9,6,23,97,116,116,97,99,107,44,32,105,116,32,99,97,110,32,98,101,32,100,101,115,116,114,111,121,101,100,9,6,25,111,110,108,121,32,102,114,111,109,32,116,104,101,32,105,110,115,105,100,101,46,32,32,32,32)
$bytes = @(9,6,22,84,104,101,32,71,114,101,97,116,32,66,97,116,116,108,101,115,104,105,112,32,115,112,101,99,115,0,1,244,9,6,21,76,101,110,103,116,104,58,32,52,46,53,32,107,109,46,9,6,23,87,101,105,103,104,116,58,32,85,110,107,110,111,119,110,9,6,25,67,114,101,119,32,32,58,32,52,48,48,48,48,32,32,32,0,1,244,9,6,22,73,116,32,104,97,115,32,97,32,98,105,103,32,119,97,114,112,32,101,110,103,105,110,101,32,9,6,24,102,111,114,32,108,111,110,103,32,106,117,109,112,115,46,32,0,2,138,9,6,21,34,86,45,82,69,70,76,69,67,84,34,32,115,121,115,116,101,109,32,114,101,112,101,108,115,32,97,110,121,9,6,23,97,116,116,97,99,107,46,32,73,116,32,99,97,110,32,98,101,32,100,101,115,116,114,111,121,101,100,9,6,25,111,110,108,121,32,102,114,111,109,32,116,104,101,32,105,110,115,105,100,101,46,32,32,32,32)

$importStartOffset = 104976 # 00019A10

0..($bytes.count-1) | %{
	$file[$_+$importStartOffset] = $bytes[$_]
}

# Буквы ввода имени

$bytes = @(65,32,47,32,66,32,47,32,67,32,47,32,68,32,47,32,69,32,47,32,70,32,47,32,71,32,47,32,72,32,47,32,73,32,47,32,74,32,47,32,75,32,47,32,76,32,47,32,77,32,47,32,78,32,47,32,79,32,0,0,80,32,47,32,81,32,47,32,82,32,47,32,83,32,47,32,84,32,47,32,85,32,47,32,86,32,47,32,87,32,47,32,88,32,47,32,89,32,47,32,90,32,47,32,47,32,47,32,47,32,47,32,47,32,47,32,47,32,0,0,97,32,47,32,98,32,47,32,99,32,47,32,100,32,47,32,101,32,47,32,102,32,47,32,103,32,47,32,104,32,47,32,105,32,47,32,106,32,47,32,107,32,47,32,108,32,47,32,109,32,47,32,110,32,47,32,111,32,0,0,112,32,47,32,113,32,47,32,114,32,47,32,115,32,47,32,116,32,47,32,117,32,47,32,118,32,47,32,119,32,47,32,120,32,47,32,121,32,47,32,122,32,47,32,47,32,47,32,47,32,47,32,47,32,47,32,47,32,0,0,33,32,47,32,34,32,47,32,35,32,47,32,36,32,47,32,37,32,47,32,38,32,47,32,39,32,47,32,40,32,47,32,41,32,47,32,42,32,47,32,43,32,47,32,44,32,47,32,45,32,47,32,46,32,47,32,32,32,0,0,48,32,47,32,49,32,47,32,50,32,47,32,51,32,47,32,52,32,47,32,53,32,47,32,54,32,47,32,55,32,47,32,56,32,47,32,57,32,47,32,47,32,47,32,47,32,47,32)

$importStartOffset = 108382 # 0001A75E

0..($bytes.count-1) | %{
 $file[$_+$importStartOffset] = $bytes[$_]
}

[System.IO.File]::WriteAllBytes($patchedRomPath,$file)
